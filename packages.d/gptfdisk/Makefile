include $(TOP)/config.mk
include config.mk

SGDISK_BINARY = gptfdisk-$(GPTFDISK_STRONG_VERSION)/sbin/sgdisk
GPTFDISK_BUILD_PRODUCT = $(GPTFDISK_SOURCETREE)/sgdisk
GPTFDISK_STRIPPED = $(GPTFDISK_BUILD_PRODUCT)-stripped
GPTFDISK_MAKEFILE = $(GPTFDISK_SOURCETREE)/Makefile

all: $(SGDISK_BINARY)

clean:
	rm -rf gptfdisk-*

$(SGDISK_BINARY): $(GPTFDISK_STRIPPED)
	mkdir -p gptfdisk-$(GPTFDISK_STRONG_VERSION)/sbin
	cp $(GPTFDISK_STRIPPED) $(SGDISK_BINARY)

$(GPTFDISK_STRIPPED): $(GPTFDISK_BUILD_PRODUCT)
	cp $(GPTFDISK_BUILD_PRODUCT) $(GPTFDISK_STRIPPED)
	strip $(GPTFDISK_STRIPPED)

$(GPTFDISK_BUILD_PRODUCT):$(GPTFDISK_TARBALL)
	$(MAKE) sgdisk -j4 -C $(GPTFDISK_SOURCETREE)

$(GPTFDISK_TARBALL):
	curl $(GPTFDISK_SOURCE) > $(GPTFDISK_TARBALL) 2>/dev/null || rm -f $(GPTFDISK_TARBALL)
	tar -xvzf $(GPTFDISK_TARBALL)
